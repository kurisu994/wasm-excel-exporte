# æµ‹è¯•ç›®å½•ç»“æ„

æœ¬ç›®å½•åŒ…å«äº† wasm-excel-exporter é¡¹ç›®çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ã€‚

## ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶ - æµ‹è¯•è¯´æ˜
â”œâ”€â”€ browser/                # æµè§ˆå™¨ç›¸å…³æµ‹è¯•
â”‚   â”œâ”€â”€ web_original.rs      # WebAssembly æµè§ˆå™¨æµ‹è¯•
â”‚   â””â”€â”€ fixtures/           # æµ‹è¯•ç”¨ä¾‹å’Œ HTML é¡µé¢
â”‚       â””â”€â”€ test-page.html   # æµ‹è¯•é¡µé¢
â”œâ”€â”€ fixtures/              # æµ‹è¯•æ•°æ®å’Œå›ºå®šæ–‡ä»¶
â”œâ”€â”€ unit/                  # å•å…ƒæµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ unit_tests.rs       # ç»¼åˆå•å…ƒæµ‹è¯•å¥—ä»¶
â””â”€â”€ BUILD_REPORT.md       # æµ‹è¯•æ„å»ºæŠ¥å‘Š
```

---

## ğŸ“‹ æ–‡ä»¶è¯´æ˜

## æµ‹è¯•ç±»å‹

### 1. å•å…ƒæµ‹è¯• (`unit/`)
- **æ–‡ä»¶**: `unit_tests.rs`
- **è¿è¡Œæ–¹å¼**: `cargo test --lib`
- **è¦†ç›–èŒƒå›´**:
  - æ–‡ä»¶åå¤„ç†é€»è¾‘
  - CSV å†™å…¥æ“ä½œ
  - å­—ç¬¦ä¸²è¾¹ç•Œæƒ…å†µ
  - é”™è¯¯å¤„ç†å’Œ JsValue è½¬æ¢
  - å†…å­˜æ•ˆç‡æµ‹è¯•

### 2. WebAssembly æµè§ˆå™¨æµ‹è¯• (`browser/`)
- **æ–‡ä»¶**: `web_original.rs`
- **è¿è¡Œæ–¹å¼**: `wasm-pack test --headless --firefox/chrome`
- **è¦†ç›–èŒƒå›´**:
  - WebAssembly ç¯å¢ƒä¸­çš„å‡½æ•°å¯¼å‡º
  - DOM æ“ä½œæµ‹è¯•
  - é”™è¯¯å¤„ç†æœºåˆ¶éªŒè¯
  - æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

### 3. æµ‹è¯•å›ºå®šæ–‡ä»¶ (`fixtures/`)
- **å†…å®¹**: HTML æµ‹è¯•é¡µé¢å’Œæµ‹è¯•æ•°æ®
- **ç”¨é€”**: ä¸ºæµè§ˆå™¨æµ‹è¯•æä¾›æ ‡å‡†åŒ–çš„æµ‹è¯•ç¯å¢ƒ

**è¿è¡Œæ–¹å¼**:
```bash
# æµè§ˆå™¨æµ‹è¯•
wasm-pack test --headless --firefox
wasm-pack test --headless --chrome

# æœ¬åœ°æµ‹è¯• (éœ€è¦ wasm-pack build)
cargo test --lib --target wasm32-unknown-unknown
```

### ğŸŒ åŠŸèƒ½éªŒè¯é¡µé¢

#### `test-page.html`
- **ç±»å‹**: æµè§ˆå™¨åŠŸèƒ½éªŒè¯é¡µé¢
- **åŠŸèƒ½**: å®Œæ•´çš„ WebAssembly åº“åŠŸèƒ½æµ‹è¯•
- **æµ‹è¯•è¦†ç›–**:
  - âœ… åŸºç¡€è¡¨æ ¼å¯¼å‡ºæµ‹è¯•
  - âœ… ç‰¹æ®Šå­—ç¬¦å’Œç©ºå€¼å¤„ç†
  - âœ… å¤§æ•°æ®é‡æ€§èƒ½æµ‹è¯• (100è¡Œ)
  - âœ… è‡ªå®šä¹‰æ–‡ä»¶åæµ‹è¯•
  - âŒ é”™è¯¯å¤„ç†éªŒè¯ (æ— æ•ˆè¾“å…¥ã€ä¸å­˜åœ¨çš„è¡¨æ ¼ç­‰)

**ä½¿ç”¨æ–¹æ³•**:
```bash
# 1. æ„å»º WebAssembly åŒ…
wasm-pack build --target web

# 2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open tests/test-page.html
# æˆ–
python -m http.server 8000 --directory tests/
```

**æµ‹è¯•åœºæ™¯**:
1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**: æ­£å¸¸è¡¨æ ¼æ•°æ®å¯¼å‡º
2. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**: ç©ºè¡¨æ ¼ã€ç‰¹æ®Šå­—ç¬¦ã€æ–‡ä»¶åå¤„ç†
3. **å¤§æ•°æ®æµ‹è¯•**: 100è¡Œæ•°æ®çš„æ€§èƒ½éªŒè¯
4. **é”™è¯¯å¤„ç†æµ‹è¯•**: å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†
5. **API å…¼å®¹æ€§**: æ–°æ—§ç‰ˆæœ¬å‡½æ•°çš„å¯¹æ¯”æµ‹è¯•

### ğŸ”§ æ„å»ºéªŒè¯å·¥å…·

#### `test-runner.js`
- **ç±»å‹**: Node.js æ„å»ºéªŒè¯è„šæœ¬
- **åŠŸèƒ½**: è‡ªåŠ¨åŒ–æ„å»ºè´¨é‡æ£€æŸ¥
- **éªŒè¯é¡¹ç›®**:
  - âœ… å¿…è¦æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
  - âœ… Package.json ç‰ˆæœ¬ä¸€è‡´æ€§
  - âœ… TypeScript å®šä¹‰éªŒè¯
  - âœ… WebAssembly æ–‡ä»¶å¤§å°åˆ†æ
  - âœ… JavaScript åŒ…æ£€æŸ¥

**è¿è¡Œæ–¹å¼**:
```bash
# æ‰§è¡Œæ„å»ºéªŒè¯
node tests/test-runner.js

# æˆ–ä½¿ç”¨ npx
npx node tests/test-runner.js
```

**éªŒè¯å†…å®¹**:
- åŒ…æ–‡ä»¶å­˜åœ¨æ€§ (`pkg/` ç›®å½•)
- ç‰ˆæœ¬å·ä¸€è‡´æ€§ (`package.json` vs `Cargo.toml`)
- TypeScript å¯¼å‡ºå®Œæ•´æ€§
- WebAssembly æ–‡ä»¶å¤§å°åˆ†æ
- JavaScript åŒ…ä»£ç è´¨é‡

### ğŸ“Š æ„å»ºè´¨é‡æŠ¥å‘Š

#### `BUILD_REPORT.md`
- **ç±»å‹**: Markdown æ„å»ºæŠ¥å‘Š
- **åŠŸèƒ½**: è¯¦ç»†çš„æ„å»ºçŠ¶æ€å’Œè´¨é‡åˆ†æ
- **ç”Ÿæˆæ—¶é—´**: æ¯æ¬¡ `test-runner.js` è¿è¡Œæ—¶è‡ªåŠ¨æ›´æ–°

**æŠ¥å‘Šå†…å®¹**:
1. **åŸºæœ¬ä¿¡æ¯**: æ„å»ºæ—¶é—´ã€åŒ…ç‰ˆæœ¬ã€æ–‡ä»¶å¤§å°
2. **æ–‡ä»¶æ£€æŸ¥**: æ‰€æœ‰å¿…è¦æ–‡ä»¶çš„å®Œæ•´åˆ—è¡¨
3. **API æ£€æŸ¥**: ä¸»å¯¼å‡ºå‡½æ•°å’Œå‘åå…¼å®¹å‡½æ•°
4. **åˆ†ææ•°æ®**: WebAssembly æ–‡ä»¶å¤§å°å’Œä¼˜åŒ–å»ºè®®
5. **ä½¿ç”¨æŒ‡å—**: æµ‹è¯•å‘½ä»¤å’Œå¼€å‘å·¥ä½œæµ

---

## ğŸš€ æµ‹è¯•æ‰§è¡ŒæŒ‡å—

### æœ¬åœ°å¼€å‘æµ‹è¯•

#### 1. å¿«é€ŸåŠŸèƒ½éªŒè¯
```bash
# æ„å»ºå¹¶éªŒè¯
wasm-pack build && node tests/test-runner.js

# å¯åŠ¨åŠŸèƒ½æµ‹è¯•é¡µé¢
cd tests && python -m http.server 8000
# æ‰“å¼€ http://localhost:8000/test-page.html
```

#### 2. å®Œæ•´æµ‹è¯•æµç¨‹
```bash
# 1. ä»£ç è´¨é‡æ£€æŸ¥
cargo check && cargo clippy -D warnings && cargo fmt --check

# 2. å•å…ƒæµ‹è¯•
cargo test --lib

# 3. WebAssembly æ„å»º
wasm-pack build --target web

# 4. æµè§ˆå™¨æµ‹è¯•
wasm-pack test --headless --firefox || wasm-pack test --headless --chrome

# 5. æ„å»ºéªŒè¯
node tests/test-runner.js
```

### CI/CD é›†æˆæµ‹è¯•

#### Travis CI / GitHub Actions
```yaml
# è‡ªåŠ¨è¿è¡Œ (å·²åœ¨ CI é…ç½®ä¸­è®¾ç½®)
- cargo test --lib --verbose
- wasm-pack build --target web --release
- node tests/test-runner.js
```

#### AppVeyor (Windows)
```yaml
# Windows ç‰¹å®šæµ‹è¯•
- cargo test --lib --verbose --target wasm32-unknown-unknown
- wasm-pack build --target web --release
```

---

## ğŸ§ª æµ‹è¯•åˆ†ç±»è¯¦è§£

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
**ç›®æ ‡**: éªŒè¯ç‹¬ç«‹å‡½æ•°å’Œé€»è¾‘ç»„ä»¶
**èŒƒå›´**:
- æ–‡ä»¶åå¤„ç†é€»è¾‘
- è¾“å…¥éªŒè¯é€»è¾‘
- CSV Writer åˆ›å»ºå’Œä½¿ç”¨
- é”™è¯¯å¤„ç†æœºåˆ¶

**ç¤ºä¾‹**:
```rust
#[test]
fn test_filename_extension_handling() {
    let test_cases = vec![
        ("test.csv", "test.csv"),
        ("report", "report.csv"),
        ("export.csv", "export.csv"),
        ("", "table_export.csv"),
    ];

    for (input, expected) in test_cases {
        // æµ‹è¯•é€»è¾‘...
    }
}
```

### 2. é›†æˆæµ‹è¯• (Integration Tests)
**ç›®æ ‡**: éªŒè¯ WebAssembly ä¸ JavaScript çš„äº¤äº’
**èŒƒå›´**:
- DOM API è°ƒç”¨
- Blob å¯¹è±¡åˆ›å»º
- ä¸‹è½½é“¾æ¥ç”Ÿæˆ
- èµ„æºç®¡ç†

**ç¯å¢ƒ**: æµè§ˆå™¨ (wasm32-unknown-unknown)

### 3. åŠŸèƒ½æµ‹è¯• (Functional Tests)
**ç›®æ ‡**: éªŒè¯å®Œæ•´çš„ç”¨æˆ·åœºæ™¯
**èŒƒå›´**:
- ç«¯åˆ°ç«¯è¡¨æ ¼å¯¼å‡ºæµç¨‹
- ä¸åŒæ•°æ®ç±»å‹å¤„ç†
- æ–‡ä»¶åè‡ªå®šä¹‰
- é”™è¯¯æƒ…å†µå¤„ç†

**ç¯å¢ƒ**: çœŸå®æµè§ˆå™¨ + HTML æµ‹è¯•é¡µé¢

### 4. æ€§èƒ½æµ‹è¯• (Performance Tests)
**ç›®æ ‡**: éªŒè¯æ€§èƒ½ç‰¹å¾å’Œè¾¹ç•Œæ¡ä»¶
**èŒƒå›´**:
- å¤§æ•°æ®é‡å¤„ç† (100+ è¡Œ)
- å†…å­˜ä½¿ç”¨ç›‘æ§
- æ„å»ºå¤§å°åˆ†æ
- æµè§ˆå™¨å…¼å®¹æ€§

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### å½“å‰è¦†ç›–èŒƒå›´

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ | è¯´æ˜ |
|----------|--------|------|
| æ ¸å¿ƒé€»è¾‘ | ~85% | ä¸»è¦å‡½æ•°å’Œé”™è¯¯å¤„ç† |
| é”™è¯¯å¤„ç† | ~90% | å„ç§å¼‚å¸¸æƒ…å†µ |
| DOM äº¤äº’ | ~80% | æµè§ˆå™¨ç¯å¢ƒæµ‹è¯• |
| æ€§èƒ½è¾¹ç•Œ | ~70% | å¤§æ•°æ®å’Œæç«¯æƒ…å†µ |
| å‘åå…¼å®¹ | ~95% | åºŸå¼ƒå‡½æ•°æµ‹è¯• |

### æ”¹è¿›ç›®æ ‡

| æµ‹è¯•ç±»å‹ | ç›®æ ‡è¦†ç›–ç‡ | æ”¹è¿›æªæ–½ |
|----------|------------|----------|
| æ ¸å¿ƒé€»è¾‘ | 95% | æ·»åŠ æ›´å¤šè¾¹ç•Œæµ‹è¯• |
| é”™è¯¯å¤„ç† | 95% | è¦†ç›–æ‰€æœ‰å¼‚å¸¸è·¯å¾„ |
| DOM äº¤äº’ | 90% | æ‰©å±•æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯• |
| æ€§èƒ½è¾¹ç•Œ | 85% | æ·»åŠ å‹åŠ›æµ‹è¯•å’Œå†…å­˜ç›‘æ§ |
| æ–‡ä»¶å¤„ç† | 100% | è¦†ç›–æ‰€æœ‰æ–‡ä»¶ååœºæ™¯ |

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§æµ‹è¯•é—®é¢˜

#### 1. WebAssembly æµ‹è¯•å¤±è´¥
**é—®é¢˜**: `wasm-pack test --headless` å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ Firefox/Chrome ç‰ˆæœ¬
firefox --version
chrome --version

# ä½¿ç”¨æœ¬åœ°æµ‹è¯•é¡µé¢
cd tests && python -m http.server 8000

# æ‰‹åŠ¨æµè§ˆå™¨æµ‹è¯•
open http://localhost:8000/test-page.html
```

#### 2. æ„å»ºéªŒè¯å¤±è´¥
**é—®é¢˜**: `node test-runner.js` æŠ¥é”™
**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿å…ˆæ„å»º
wasm-pack build

# æ£€æŸ¥ pkg ç›®å½•
ls -la pkg/

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
node tests/test-runner.js --verbose
```

#### 3. å•å…ƒæµ‹è¯•æ— æ³•è¿è¡Œ
**é—®é¢˜**: `cargo test` åœ¨ wasm32 ç›®æ ‡å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
```bash
# åªè¿è¡Œæœ¬åœ°æµ‹è¯•
cargo test --lib

# æ£€æŸ¥ wasm-bindgen-test ä¾èµ–
cargo test --features wasm-bindgen-test

# ä½¿ç”¨åŸç”Ÿç›®æ ‡
cargo test --target x86_64-unknown-linux-gnu
```

---

## ğŸ“ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‰æ£€æŸ¥æ¸…å•
- [ ] `wasm-pack build` æˆåŠŸå®Œæˆ
- [ ] `pkg/` ç›®å½•åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶
- [ ] æµè§ˆå™¨æ”¯æŒ WebAssembly
- [ ] Node.js ç‰ˆæœ¬å…¼å®¹æ€§

### 2. æµ‹è¯•æ‰§è¡ŒæŒ‡å—
- [ ] è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥ (`cargo check`, `cargo clippy`)
- [ ] æ‰§è¡Œå•å…ƒæµ‹è¯• (`cargo test --lib`)
- [ ] éªŒè¯ WebAssembly æ„å»º
- [ ] åœ¨å¤šä¸ªæµè§ˆå™¨ä¸­æµ‹è¯•åŠŸèƒ½
- [ ] è¿è¡Œæ€§èƒ½éªŒè¯

### 3. æµ‹è¯•åæ£€æŸ¥
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æ— æ§åˆ¶å°é”™è¯¯æˆ–è­¦å‘Š
- [ ] WebAssembly åŒ…å¤§å°åˆç† (< 100KB)
- [ ] æµè§ˆå™¨å…¼å®¹æ€§éªŒè¯

---

## ğŸ”„ æŒç»­é›†æˆ

### è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
```bash
#!/bin/bash
# å®Œæ•´çš„æµ‹è¯•è„šæœ¬ (test-all.sh)

set -e

echo "ğŸ” 1. ä»£ç è´¨é‡æ£€æŸ¥..."
cargo check --verbose
cargo clippy -D warnings --all-targets
cargo fmt --check

echo "ğŸ§ª 2. è¿è¡Œå•å…ƒæµ‹è¯•..."
cargo test --lib --verbose

echo "ğŸ— 3. WebAssembly æ„å»º..."
wasm-pack build --target web --release

echo "ğŸ”§ 4. æ„å»ºéªŒè¯..."
node tests/test-runner.js

echo "ğŸŒ 5. åŠŸèƒ½éªŒè¯..."
echo "å¯åŠ¨åŠŸèƒ½æµ‹è¯•é¡µé¢: http://localhost:8000/test-page.html"
cd tests
python -m http.server 8000

echo "âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ!"
```

### CI/CD é›†æˆ
æ‰€æœ‰æµ‹è¯•éƒ½å·²ç»é›†æˆåˆ° CI/CD æµç¨‹ä¸­:
- **Travis CI**: Linux + Firefox/Chrome æµ‹è¯•
- **AppVeyor**: Windows + å¤šç‰ˆæœ¬æµ‹è¯•
- **GitHub Actions**: å¹¶è¡Œæ„å»º + è‡ªåŠ¨æµè§ˆå™¨æµ‹è¯•

---

## ğŸ“‹ æ€»ç»“

è¿™ä¸ªæµ‹è¯•å¥—ä»¶æä¾›äº†å…¨é¢çš„éªŒè¯æ¡†æ¶ï¼Œç¡®ä¿ `wasm-excel-exporter` åœ¨å„ç§ç¯å¢ƒå’Œæ¡ä»¶ä¸‹çš„å¯é æ€§ã€‚

**æµ‹è¯•æ–‡ä»¶æ¦‚è§ˆ**:
- `web.rs` - WebAssembly å•å…ƒæµ‹è¯•
- `test-page.html` - æµè§ˆå™¨åŠŸèƒ½éªŒè¯
- `test-runner.js` - æ„å»ºè´¨é‡æ£€æŸ¥
- `README.md` - æœ¬æ–‡æ¡£
- `BUILD_REPORT.md` - è‡ªåŠ¨ç”Ÿæˆçš„æ„å»ºæŠ¥å‘Š

**ä½¿ç”¨å»ºè®®**:
1. **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨ `test-runner.js` è¿›è¡Œå¿«é€ŸéªŒè¯
2. **åŠŸèƒ½æµ‹è¯•**: ä½¿ç”¨ `test-page.html` è¿›è¡Œæ‰‹åŠ¨éªŒè¯
3. **CI/CD**: ä¾èµ–è‡ªåŠ¨åŒ–æµç¨‹è¿›è¡ŒæŒç»­éªŒè¯
4. **å‘å¸ƒå‰**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿è´¨é‡