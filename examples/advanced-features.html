<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§ç‰¹æ€§ç¤ºä¾‹ - wasm-excel-exporter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .demo-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            transition: transform 0.3s ease;
        }

        .demo-card:hover {
            transform: translateY(-5px);
        }

        .demo-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .demo-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }

        td {
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .info-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-top: 20px;
        }

        .info-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            line-height: 1.6;
            color: #555;
        }

        .feature-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
            font-size: 18px;
        }

        .validation-result {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 150px;
            overflow-y: auto;
        }

        .validation-result .valid {
            color: #2e7d32;
        }

        .validation-result .invalid {
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ é«˜çº§ç‰¹æ€§æ¼”ç¤º</h1>
            <p class="subtitle">å±•ç¤º wasm-excel-exporter çš„æ‰€æœ‰é«˜çº§åŠŸèƒ½</p>
        </div>

        <div class="demo-grid">
            <!-- ç¤ºä¾‹ 1: è‡ªå®šä¹‰æ–‡ä»¶å -->
            <div class="demo-card">
                <h2>ğŸ“ è‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º</h2>
                <p>è¾“å…¥æ‚¨æƒ³è¦çš„æ–‡ä»¶åï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  .csv æ‰©å±•åï¼‰</p>

                <input type="text" id="custom-filename" placeholder="ä¾‹å¦‚: æˆ‘çš„æ•°æ®" value="é”€å”®æŠ¥è¡¨_2024">

                <table id="table-1">
                    <thead>
                        <tr>
                            <th>æœˆä»½</th>
                            <th>é”€å”®é¢</th>
                            <th>å¢é•¿ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1æœˆ</td><td>Â¥120,000</td><td>+15%</td></tr>
                        <tr><td>2æœˆ</td><td>Â¥135,000</td><td>+12.5%</td></tr>
                        <tr><td>3æœˆ</td><td>Â¥142,000</td><td>+5.2%</td></tr>
                    </tbody>
                </table>

                <button onclick="exportCustomFilename()">å¯¼å‡º</button>
                <div class="message" id="message-1"></div>
            </div>

            <!-- ç¤ºä¾‹ 2: æ–‡ä»¶åéªŒè¯ -->
            <div class="demo-card">
                <h2>ğŸ›¡ï¸ æ–‡ä»¶åå®‰å…¨éªŒè¯</h2>
                <p>å°è¯•è¾“å…¥ä¸åŒçš„æ–‡ä»¶åï¼ŒæŸ¥çœ‹éªŒè¯ç»“æœ</p>

                <input type="text" id="test-filename" placeholder="è¾“å…¥æ–‡ä»¶åæµ‹è¯•">

                <button onclick="testFilenameValidation()">éªŒè¯æ–‡ä»¶å</button>

                <div class="validation-result" id="validation-result">
                    <div>ç­‰å¾…è¾“å…¥æ–‡ä»¶å...</div>
                </div>
            </div>

            <!-- ç¤ºä¾‹ 3: æ‰¹é‡å¯¼å‡º -->
            <div class="demo-card">
                <h2>ğŸ“¦ æ‰¹é‡å¯¼å‡ºå¤šä¸ªè¡¨æ ¼</h2>
                <p>ä¸€æ¬¡æ€§å¯¼å‡ºå¤šä¸ªè¡¨æ ¼åˆ°ä¸åŒçš„æ–‡ä»¶</p>

                <table id="table-batch-1">
                    <thead>
                        <tr><th>éƒ¨é—¨</th><th>äººæ•°</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>æŠ€æœ¯éƒ¨</td><td>45</td></tr>
                        <tr><td>å¸‚åœºéƒ¨</td><td>30</td></tr>
                    </tbody>
                </table>

                <table id="table-batch-2" style="margin-top: 10px;">
                    <thead>
                        <tr><th>äº§å“</th><th>åº“å­˜</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>äº§å“A</td><td>120</td></tr>
                        <tr><td>äº§å“B</td><td>85</td></tr>
                    </tbody>
                </table>

                <button onclick="exportBatch()">æ‰¹é‡å¯¼å‡º</button>
                <div class="message" id="message-batch"></div>
            </div>

            <!-- ç¤ºä¾‹ 4: é”™è¯¯å¤„ç† -->
            <div class="demo-card">
                <h2>ğŸš¨ é”™è¯¯å¤„ç†æ¼”ç¤º</h2>
                <p>æ¼”ç¤ºå„ç§é”™è¯¯æƒ…å†µçš„å¤„ç†</p>

                <button onclick="testInvalidTableId()" style="margin-bottom: 10px;">æµ‹è¯•æ— æ•ˆè¡¨æ ¼ID</button>
                <button onclick="testInvalidFilename()" style="margin-bottom: 10px;">æµ‹è¯•éæ³•æ–‡ä»¶å</button>
                <button onclick="testEmptyFilename()">æµ‹è¯•ç©ºæ–‡ä»¶å</button>

                <div class="message" id="message-error"></div>
            </div>
        </div>

        <div class="info-section">
            <h2>âœ¨ åŠŸèƒ½ç‰¹æ€§</h2>
            <ul class="feature-list">
                <li><strong>æ–‡ä»¶åè‡ªåŠ¨å¤„ç†ï¼š</strong>è‡ªåŠ¨æ·»åŠ  .csv æ‰©å±•åï¼Œä¿æŒåŸæœ‰å¤§å°å†™</li>
                <li><strong>å®‰å…¨éªŒè¯ï¼š</strong>é˜²æ­¢è·¯å¾„éå†ã€å±é™©å­—ç¬¦ã€Windows ä¿ç•™åç§°</li>
                <li><strong>Unicode æ”¯æŒï¼š</strong>å®Œç¾æ”¯æŒä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰å¤šè¯­è¨€æ–‡ä»¶å</li>
                <li><strong>æ‰¹é‡å¯¼å‡ºï¼š</strong>å¯ä»¥ä¸€æ¬¡æ€§å¯¼å‡ºå¤šä¸ªè¡¨æ ¼</li>
                <li><strong>é”™è¯¯å¤„ç†ï¼š</strong>å‹å¥½çš„é”™è¯¯æç¤ºï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜</li>
                <li><strong>å†…å­˜å®‰å…¨ï¼š</strong>ä½¿ç”¨ Rust çš„ RAII æ¨¡å¼è‡ªåŠ¨ç®¡ç†èµ„æº</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import init, { export_table_to_csv } from '../pkg/wasm_excel_exporter.js';

        let wasmInitialized = false;

        async function initWasm() {
            if (!wasmInitialized) {
                try {
                    await init();
                    wasmInitialized = true;
                    console.log('âœ… WASM æ¨¡å—åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ WASM åˆå§‹åŒ–å¤±è´¥:', error);
                    throw error;
                }
            }
        }

        function showMessage(elementId, message, type = 'success') {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = message;
            messageDiv.className = `message ${type} show`;
            setTimeout(() => {
                messageDiv.classList.remove('show');
            }, 3000);
        }

        // ç¤ºä¾‹ 1: è‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º
        window.exportCustomFilename = async function() {
            try {
                await initWasm();
                const filename = document.getElementById('custom-filename').value || 'é»˜è®¤æ–‡ä»¶å';
                export_table_to_csv('table-1', filename);
                showMessage('message-1', `âœ… å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å: ${filename}.csv`, 'success');
            } catch (error) {
                showMessage('message-1', `âŒ å¯¼å‡ºå¤±è´¥: ${error}`, 'error');
            }
        };

        // ç¤ºä¾‹ 2: æ–‡ä»¶åéªŒè¯ï¼ˆæ¨¡æ‹Ÿï¼‰
        window.testFilenameValidation = function() {
            const filename = document.getElementById('test-filename').value;
            const resultDiv = document.getElementById('validation-result');

            const tests = [
                { name: 'ç©ºæ–‡ä»¶åæ£€æŸ¥', pass: filename.length > 0 },
                { name: 'è·¯å¾„åˆ†éš”ç¬¦æ£€æŸ¥', pass: !filename.includes('/') && !filename.includes('\\') },
                { name: 'å±é™©å­—ç¬¦æ£€æŸ¥', pass: !/[<>:"|?*]/.test(filename) },
                { name: 'é•¿åº¦æ£€æŸ¥', pass: filename.length <= 255 },
                { name: 'å¼€å¤´ç»“å°¾æ£€æŸ¥', pass: !filename.startsWith('.') && !filename.startsWith(' ') &&
                                              !filename.endsWith('.') && !filename.endsWith(' ') },
            ];

            const reservedNames = ['CON', 'PRN', 'AUX', 'NUL', 'COM1', 'COM2', 'COM3', 'LPT1', 'LPT2'];
            const baseName = filename.split('.')[0].toUpperCase();
            tests.push({ name: 'Windowsä¿ç•™åæ£€æŸ¥', pass: !reservedNames.includes(baseName) });

            let html = `<div style="margin-bottom: 10px;"><strong>æ–‡ä»¶å: "${filename}"</strong></div>`;
            let allPass = true;

            tests.forEach(test => {
                const className = test.pass ? 'valid' : 'invalid';
                const icon = test.pass ? 'âœ“' : 'âœ—';
                html += `<div class="${className}">${icon} ${test.name}</div>`;
                if (!test.pass) allPass = false;
            });

            html += `<div style="margin-top: 10px; padding-top: 10px; border-top: 2px solid #ddd;">`;
            if (allPass) {
                html += `<div class="valid"><strong>âœ“ éªŒè¯é€šè¿‡</strong></div>`;
            } else {
                html += `<div class="invalid"><strong>âœ— éªŒè¯å¤±è´¥</strong></div>`;
            }
            html += `</div>`;

            resultDiv.innerHTML = html;
        };

        // ç¤ºä¾‹ 3: æ‰¹é‡å¯¼å‡º
        window.exportBatch = async function() {
            try {
                await initWasm();
                const tables = [
                    { id: 'table-batch-1', filename: 'éƒ¨é—¨ç»Ÿè®¡' },
                    { id: 'table-batch-2', filename: 'äº§å“åº“å­˜' }
                ];

                let successCount = 0;
                for (const table of tables) {
                    export_table_to_csv(table.id, table.filename);
                    successCount++;
                    // æ·»åŠ å°å»¶è¿Ÿï¼Œé¿å…æµè§ˆå™¨ä¸‹è½½é™åˆ¶
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                showMessage('message-batch', `âœ… æˆåŠŸå¯¼å‡º ${successCount} ä¸ªæ–‡ä»¶ï¼`, 'success');
            } catch (error) {
                showMessage('message-batch', `âŒ æ‰¹é‡å¯¼å‡ºå¤±è´¥: ${error}`, 'error');
            }
        };

        // ç¤ºä¾‹ 4: é”™è¯¯å¤„ç†
        window.testInvalidTableId = async function() {
            try {
                await initWasm();
                export_table_to_csv('non-existent-table', 'æµ‹è¯•');
            } catch (error) {
                showMessage('message-error', `é¢„æœŸé”™è¯¯: ${error}`, 'error');
            }
        };

        window.testInvalidFilename = async function() {
            try {
                await initWasm();
                export_table_to_csv('table-1', 'invalid/filename');
            } catch (error) {
                showMessage('message-error', `é¢„æœŸé”™è¯¯: ${error}`, 'error');
            }
        };

        window.testEmptyFilename = async function() {
            try {
                await initWasm();
                export_table_to_csv('table-1', '');
            } catch (error) {
                showMessage('message-error', `é¢„æœŸé”™è¯¯: ${error}`, 'error');
            }
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        initWasm().catch(error => {
            console.error('åˆå§‹åŒ–å¤±è´¥:', error);
        });
    </script>
</body>
</html>

